<!DOCTYPE html>
<html>
<head>
    <title>Debug Date Badge Function</title>
</head>
<body>
    <h2>Debug Date Badge Function</h2>
    <div id="output"></div>

    <script>
        // Copy the exact function from our dashboard
        function getUploadDateBadge(dateString, fallbackDate) {
            // Try primary date first, then fallback date, then return unknown
            const primaryDate = dateString || fallbackDate;
            if (!primaryDate) return { class: 'date-older', text: 'Unknown' };
            
            try {
                // Parse the UTC timestamp
                const utcDate = new Date(primaryDate);
                
                // Validate date object
                if (isNaN(utcDate.getTime())) {
                    return { class: 'date-older', text: 'Invalid Date' };
                }
                
                // Get current date in IST timezone
                const now = new Date();
                const istToday = new Date(now.toLocaleString('en-US', {timeZone: 'Asia/Kolkata'}));
                
                // Convert UTC date to IST
                const istUploadDate = new Date(utcDate.toLocaleString('en-US', {timeZone: 'Asia/Kolkata'}));
                
                // Get date strings for comparison (ignore time)
                const todayDateString = istToday.toDateString();
                const uploadDateString = istUploadDate.toDateString();
                
                // Compare dates
                if (uploadDateString === todayDateString) {
                    return { class: 'date-today', text: 'Today' };
                }
                
                // Check for yesterday
                const yesterday = new Date(istToday);
                yesterday.setDate(yesterday.getDate() - 1);
                const yesterdayDateString = yesterday.toDateString();
                
                if (uploadDateString === yesterdayDateString) {
                    return { class: 'date-yesterday', text: 'Yesterday' };
                }
                
                // Calculate days difference more accurately
                const timeDiff = istToday.setHours(0,0,0,0) - istUploadDate.setHours(0,0,0,0);
                const daysDiff = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                
                if (daysDiff <= 7 && daysDiff > 0) {
                    return { class: 'date-week', text: `${daysDiff}d ago` };
                } else if (daysDiff < 0) {
                    // Future date
                    return { class: 'date-future', text: 'Future' };
                }
                
                return { class: 'date-older', text: `${daysDiff}d ago` };
                
            } catch (error) {
                console.error('Error in getUploadDateBadge:', error, primaryDate);
                return { class: 'date-older', text: 'Date Error' };
            }
        }

        // Test the function with debug output
        const testOutput = document.getElementById('output');
        
        // Current time info
        const now = new Date();
        const istNow = new Date(now.toLocaleString('en-US', {timeZone: 'Asia/Kolkata'}));
        
        // Test timestamps (these are from your database)
        const testTimestamps = [
            '2025-09-27T21:58:36.830525',  // Should be Today in IST
            '2025-09-27T15:30:00.000000',  // Should be Today in IST
            '2025-09-26T15:30:00.000000',  // Should be Yesterday in IST
            '2025-09-25T15:30:00.000000'   // Should be 2d ago
        ];
        
        let debugInfo = `
            <h3>Current Time Info:</h3>
            <p><strong>Local Now:</strong> ${now.toString()}</p>
            <p><strong>IST Now:</strong> ${istNow.toString()}</p>
            <p><strong>IST Date String:</strong> ${istNow.toDateString()}</p>
            
            <h3>Test Results:</h3>
        `;
        
        testTimestamps.forEach((ts, index) => {
            const result = getUploadDateBadge(ts);
            const utcDate = new Date(ts);
            const istDate = new Date(utcDate.toLocaleString('en-US', {timeZone: 'Asia/Kolkata'}));
            
            debugInfo += `
                <div style="margin: 10px 0; padding: 10px; border: 1px solid #ccc;">
                    <p><strong>Test ${index + 1}:</strong> ${ts}</p>
                    <p><strong>UTC Date:</strong> ${utcDate.toString()}</p>
                    <p><strong>IST Date:</strong> ${istDate.toString()}</p>
                    <p><strong>IST Date String:</strong> ${istDate.toDateString()}</p>
                    <p><strong>Result:</strong> <span style="background: yellow;">${result.text}</span></p>
                    <p><strong>Match Today?:</strong> ${istDate.toDateString() === istNow.toDateString()}</p>
                </div>
            `;
        });
        
        testOutput.innerHTML = debugInfo;
    </script>
</body>
</html>
